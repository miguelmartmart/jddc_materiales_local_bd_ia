<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEVIA - Sistema de Gesti√≥n IA</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <h1>üöÄ DEVIA</h1>
            </div>
            <nav>
                <ul>
                    <li class="active" data-view="dashboard">üìä Dashboard</li>
                    <li data-view="articles">üì¶ Gesti√≥n Art√≠culos</li>
                    <li data-view="prompts">‚öôÔ∏è Configuraci√≥n Prompts</li>
                    <li data-view="models">ü§ñ Modelos IA</li>
                    <li data-view="database-config">üóÑÔ∏è Configuraci√≥n BD</li>
                    <li data-view="chat">üí¨ Chat IA</li>
                    <li data-view="outlook">üìß Outlook</li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <h2 id="page-title">Dashboard</h2>
                <div class="user-profile">
                    <span>Admin</span>
                </div>
            </header>

            <div id="content-area">
                <!-- Dashboard -->
                <div id="view-dashboard" class="view-section active">
                    <div class="card">
                        <h3>Bienvenido a DEVIA</h3>
                        <p>Seleccione una opci√≥n del men√∫ para comenzar.</p>
                    </div>
                </div>

                <!-- Articles -->
                <div id="view-articles" class="view-section" style="display: none;">
                    <div class="toolbar">
                        <button id="btn-load-articles" class="btn primary">üì• Cargar Art√≠culos</button>
                        <button id="btn-analyze-all" class="btn secondary">üöÄ Analizar Todo</button>
                        <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">Modelo IA:</label>
                            <select id="articles-model-selector"
                                style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                                <option value="">Cargando modelos...</option>
                            </select>
                        </div>
                    </div>
                    <div class="data-grid-container">
                        <table id="articles-table">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Nombre Original</th>
                                    <th>Material (IA)</th>
                                    <th>Categor√≠a (IA)</th>
                                    <th>Confianza</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Prompts -->
                <div id="view-prompts" class="view-section" style="display: none;">
                    <div class="card">
                        <h3>Configuraci√≥n de Prompts</h3>
                        <form id="prompt-form">
                            <div class="form-group">
                                <label>Nombre Configuraci√≥n</label>
                                <input type="text" id="prompt-name" placeholder="Ej: Experto">
                            </div>
                            <div class="form-group">
                                <label>Nivel Complejidad</label>
                                <select id="prompt-level">
                                    <option value="beginner">Principiante</option>
                                    <option value="expert">Experto</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>System Prompt</label>
                                <textarea id="prompt-system" rows="4"></textarea>
                            </div>
                            <button type="submit" class="btn primary">Guardar Configuraci√≥n</button>
                        </form>
                    </div>
                </div>

                <!-- Models -->
                <div id="view-models" class="view-section" style="display: none;">
                    <div class="toolbar">
                        <button id="btn-add-model" class="btn primary">‚ûï A√±adir Modelo</button>
                        <button id="btn-reload-models" class="btn secondary">üîÑ Recargar</button>
                    </div>
                    <div class="data-grid-container">
                        <table id="models-table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Proveedor</th>
                                    <th>Model ID</th>
                                    <th>Estado</th>
                                    <th>API Key</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <!-- Modal for Add/Edit Model -->
                    <div id="model-modal" class="modal" style="display: none;">
                        <div class="modal-content"
                            style="max-width: 600px; margin: 50px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                            <h3 id="modal-title">A√±adir Modelo</h3>
                            <form id="model-form">
                                <div class="form-group">
                                    <label>ID *</label>
                                    <input type="text" id="model-id" required placeholder="ej: groq-llama-70b">
                                </div>
                                <div class="form-group">
                                    <label>Nombre *</label>
                                    <input type="text" id="model-name" required placeholder="ej: Groq Llama 3.3 70B">
                                </div>
                                <div class="form-group">
                                    <label>Proveedor *</label>
                                    <select id="model-provider" required>
                                        <option value="gemini">Gemini</option>
                                        <option value="openai_compatible">OpenAI Compatible (Groq, DeepSeek, Qwen, etc.)
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Model ID *</label>
                                    <input type="text" id="model-model-id" required
                                        placeholder="ej: llama-3.3-70b-versatile">
                                </div>
                                <div class="form-group">
                                    <label>API Key</label>
                                    <input type="password" id="model-api-key" placeholder="Dejar vac√≠o para no cambiar">
                                </div>
                                <div class="form-group">
                                    <label>Base URL (solo para OpenAI Compatible)</label>
                                    <input type="text" id="model-base-url"
                                        placeholder="ej: https://api.groq.com/openai/v1">
                                </div>
                                <div class="form-group">
                                    <label>Descripci√≥n</label>
                                    <textarea id="model-description" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="model-enabled" checked>
                                        Habilitado
                                    </label>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 20px;">
                                    <button type="submit" class="btn primary">Guardar</button>
                                    <button type="button" id="btn-cancel-model" class="btn secondary">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Database Config -->
                <div id="view-database-config" class="view-section" style="display: none;">
                    <div class="card">
                        <h3>Configuraci√≥n de Base de Datos</h3>
                        <div class="toolbar" style="margin-bottom: 20px;">
                            <div style="display: flex; gap: 10px; align-items: center; flex: 1;">
                                <label>Analizar Tabla:</label>
                                <select id="db-table-selector"
                                    style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;">
                                    <option value="">Cargando tablas...</option>
                                </select>
                                <button id="btn-analyze-table" class="btn secondary">ü§ñ Analizar con IA</button>
                            </div>
                            <button id="btn-save-metadata" class="btn primary">üíæ Guardar Cambios</button>
                        </div>

                        <div style="display: flex; gap: 20px;">
                            <div style="flex: 1;">
                                <h4>Editor de Metadatos (JSON)</h4>
                                <textarea id="metadata-editor"
                                    style="width: 100%; height: 500px; font-family: monospace; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                            </div>
                            <div style="flex: 1; display: none;" id="analysis-preview-container">
                                <h4>Vista Previa An√°lisis</h4>
                                <div id="analysis-preview"
                                    style="background: #f5f5f5; padding: 10px; border-radius: 4px; height: 450px; overflow-y: auto; font-family: monospace; white-space: pre-wrap;">
                                </div>
                                <button id="btn-append-analysis" class="btn primary"
                                    style="width: 100%; margin-top: 10px;">‚¨áÔ∏è A√±adir al Editor</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat -->
                <div id="view-chat" class="view-section" style="display: none;">
                    <div class="card" style="height: 70vh; display: flex; flex-direction: column;">
                        <div style="margin-bottom: 10px; display: flex; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">Modelo IA:</label>
                            <select id="chat-model-selector"
                                style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Cargando modelos...</option>
                            </select>
                        </div>
                        <div id="chat-messages"
                            style="flex: 1; overflow-y: auto; padding: 10px; border: 1px solid #eee; margin-bottom: 10px; border-radius: 4px;">
                            <div class="message ai"
                                style="background: #f5f5f5; padding: 10px; border-radius: 8px; max-width: 80%;">
                                Hola, soy DEVIA. ¬øEn qu√© puedo ayudarte hoy?
                            </div>
                        </div>
                        <div class="chat-input-area" style="display: flex; gap: 10px;">
                            <input type="text" id="chat-input" placeholder="Escribe tu mensaje..."
                                style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <button id="btn-send-chat" class="btn primary">Enviar</button>
                        </div>
                    </div>
                </div>
                <!-- Outlook View -->
                <div id="view-outlook" class="view-section" style="display: none;">
                    <div class="card">
                        <div class="panel-header">
                            <div>
                                <h3>üìß Bandeja de Entrada Unificada</h3>
                                <p class="text-sm text-gray-500" style="margin: 0; color: #666; font-size: 0.9em;">
                                    Sincronizaci√≥n autom√°tica activa <span class="live-indicator"></span>
                                </p>
                            </div>
                            <div id="connection-status" class="status-badge disconnected">
                                ‚ö™ Desconectado
                            </div>
                        </div>

                        <!-- Credentials Warning (Collapsible potentially, but keep visible for now) -->
                        <div class="alert-box info" id="config-alert"
                            style="display: none; background: #e3f2fd; color: #0d47a1; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
                            <p><small>Configura tus credenciales en el archivo <code>.env</code> para auto-conexi√≥n
                                    (Outlook o Gmail).</small></p>
                        </div>

                        <!-- Manual Login Form (Hidden if configured) -->
                        <div id="manual-login-form" class="form-group"
                            style="display: flex; gap: 20px; align-items: flex-end; margin-bottom: 20px;">
                            <div style="flex: 1;">
                                <label>Usuario</label>
                                <input type="email" id="outlook-email" placeholder="usuario@..."
                                    style="width: 100%; padding: 8px;">
                            </div>
                            <div style="flex: 1;">
                                <label>Contrase√±a</label>
                                <input type="password" id="outlook-password" placeholder="***"
                                    style="width: 100%; padding: 8px;">
                            </div>
                        </div>

                        <div class="toolbar-actions"
                            style="background: #f5f9ff; padding: 10px; border-radius: 6px; border: 1px solid #e3f2fd; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <button id="btn-fetch-emails" class="btn primary">üîÑ Sincronizar Ahora</button>

                            <div style="display: flex; align-items: center; gap: 10px; margin-right: 10px;">
                                <label
                                    style="display: flex; align-items: center; gap: 5px; font-size: 0.9em; cursor: pointer; color: #333;">
                                    <input type="checkbox" id="analyze-unread-only">
                                    Solo No Le√≠dos
                                </label>

                                <select id="analyze-date-filter" class="form-select" style="max-width: 140px;">
                                    <option value="all">üìÖ Todo el historial</option>
                                    <option value="today">üìÖ Hoy</option>
                                    <option value="yesterday">üìÖ Ayer</option>
                                    <option value="3days" selected>üìÖ √öltimos 3 d√≠as</option>
                                    <option value="week">üìÖ Esta semana</option>
                                </select>

                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <label style="font-size: 0.9em; color: #1565c0;">L√≠mite:</label>
                                    <input type="number" id="analyze-limit" value="30" min="1" max="150"
                                        style="width: 60px; padding: 6px; border: 1px solid #bbdefb; border-radius: 4px; text-align: center;">
                                </div>
                            </div>

                            <button id="btn-analyze-emails" class="btn secondary"
                                style="background: #1565c0; color: white;">üß† Analizar con IA</button>

                            <button id="btn-enable-notifications" class="btn secondary" style="margin-left: auto;">üîî
                                Alertas</button>
                            <span id="last-updated" style="font-size: 0.85em; color: #888; align-self: center;">
                                Actualizado: Nunca
                            </span>
                        </div>

                        <!-- Analysis Panel (Hidden by default) -->
                        <div id="analysis-panel"
                            style="display: none; background: #fafafa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="margin-top: 0; display: flex; align-items: center; gap: 10px;">
                                üìä Reporte de Inteligencia Artificial
                                <button id="close-analysis"
                                    style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 1.2em;">‚úñ</button>
                            </h4>

                            <div class="stats-grid"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div class="stat-card"
                                    style="background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="font-size: 0.9em; color: #666;">Correos Analizados</div>
                                    <div id="stat-total" style="font-size: 1.5em; font-weight: bold; color: #333;">0
                                    </div>
                                </div>
                                <div class="stat-card"
                                    style="background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="font-size: 0.9em; color: #666;">Sin Leer (Total)</div>
                                    <div id="stat-unread" style="font-size: 1.5em; font-weight: bold; color: #d32f2f;">0
                                    </div>
                                </div>
                                <div class="stat-card"
                                    style="background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="font-size: 0.9em; color: #666;">Con Adjuntos</div>
                                    <div id="stat-attachments"
                                        style="font-size: 1.5em; font-weight: bold; color: #1976d2;">0</div>
                                </div>
                            </div>

                            <!-- Timeline (Collapsible) -->
                            <details open style="margin-bottom: 20px;">
                                <summary
                                    style="cursor: pointer; font-weight: 600; color: #333; list-style: none; display: flex; align-items: center; gap: 5px; margin-bottom: 10px;">
                                    üìÖ Actividad (√öltimos d√≠as)
                                    <span style="font-size: 0.8em; color: #888;">‚ñº</span>
                                </summary>
                                <ul id="timeline-list"
                                    style="list-style: none; padding: 0 0 0 10px; margin: 0; color: #555; border-left: 3px solid #eee;">
                                </ul>
                            </details>

                            <!-- AI Results (Collapsible) -->
                            <details open>
                                <summary
                                    style="cursor: pointer; font-weight: 600; color: #333; list-style: none; display: flex; align-items: center; gap: 5px; margin-bottom: 10px;">
                                    üìù Res√∫menes Inteligentes
                                    <span style="font-size: 0.8em; color: #888;">‚ñº</span>
                                </summary>
                                <div id="analysis-results" style="display: flex; flex-direction: column; gap: 10px;">
                                    <!-- Cards will be injected here -->
                                    <div style="text-align: center; color: #999;">Cargando an√°lisis...</div>
                                </div>
                            </details>
                        </div>

                        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

                        <div id="email-results">
                            <div id="email-list" class="email-list-container scrollable-list">
                                <div class="no-data"
                                    style="color: #666; font-style: italic; text-align: center; padding: 20px;">
                                    Esperando sincronizaci√≥n...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module" src="assets/js/core/app.js"></script>
</body>

</html>